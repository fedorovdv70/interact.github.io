<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üê± –î–µ—Ç–µ–∫—Ç–æ—Ä –ö–æ—Ç–∞ (–§–æ—Ç–æ)</title>

  <!-- TensorFlow.js + COCO-SSD -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.7.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.2"></script>

  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      text-align: center;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin: 0;
      padding: 20px;
      color: #fff;
      min-height: 100vh;
    }
    .container {
      max-width: 700px;
      margin: 0 auto;
      background: rgba(255,255,255,0.1);
      padding: 30px;
      border-radius: 20px;
      backdrop-filter: blur(10px);
      box-shadow: 0 15px 35px rgba(0,0,0,0.2);
    }
    h1 {
      font-size: 2.5em;
      margin: 0 0 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    p { margin: 10px 0 20px; font-size: 1.1em; }

    .upload-area {
      border: 4px dashed #fff;
      border-radius: 15px;
      padding: 40px;
      margin: 20px 0;
      background: rgba(255,255,255,0.1);
      transition: all 0.3s;
      cursor: pointer;
    }
    .upload-area:hover {
      background: rgba(255,255,255,0.2);
      transform: scale(1.02);
    }
    .upload-area.dragover {
      background: rgba(255,255,255,0.3);
      border-color: #ff6b6b;
    }

    #imagePreview {
      max-width: 100%;
      max-height: 400px;
      margin: 20px auto;
      border-radius: 15px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.3);
      display: none;
    }

    #canvas {
      max-width: 100%;
      border-radius: 15px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.3);
      margin: 10px auto;
      display: none;
    }

    #status {
      font-size: 1.4em;
      margin: 20px 0;
      padding: 15px;
      background: rgba(255,255,255,0.2);
      border-radius: 12px;
      min-height: 60px;
      transition: all 0.5s;
      font-weight: bold;
    }
    .cat-detected {
      background: #ff6b6b !important;
      color: white;
      animation: pulse 1s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    button {
      padding: 12px 30px;
      font-size: 1.1em;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      margin: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      transition: all 0.3s;
    }
    button:hover {
      background: #45a049;
      transform: translateY(-2px);
    }
    button:disabled {
      background: #999;
      cursor: not-allowed;
      transform: none;
    }

    .paw-print {
      font-size: 3em;
      margin: 20px 0;
      animation: float 3s infinite;
    }
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }

    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üêæ –î–µ—Ç–µ–∫—Ç–æ—Ä –ö–æ—Ç–∞</h1>
    <p>–ó–∞–≥—Ä—É–∑–∏ —Ñ–æ—Ç–æ ‚Äî —É–∑–Ω–∞–π, –µ—Å—Ç—å –ª–∏ –Ω–∞ –Ω—ë–º –∫–æ—Ç!</p>

    <div class="upload-area" id="uploadArea">
      <p>üì∏ –ü–µ—Ä–µ—Ç–∞—â–∏ —Ñ–æ—Ç–æ —Å—é–¥–∞ –∏–ª–∏ –∫–ª–∏–∫–Ω–∏</p>
      <input type="file" id="fileInput" accept="image/*" class="hidden" />
    </div>

    <img id="imagePreview" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä" />
    <canvas id="canvas"></canvas>

    <div id="status">–í—ã–±–µ—Ä–∏ —Ñ–æ—Ç–æ —Å –∫–æ—Ç–æ–º... üò∫</div>

    <button id="detectBtn" onclick="detectCat()" disabled>üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –∫–æ—Ç–∞</button>
    <button onclick="reset()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</button>

    <div class="paw-print">üêæ üêæ üêæ</div>
  </div>

  <script>
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const imagePreview = document.getElementById('imagePreview');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const status = document.getElementById('status');
    const detectBtn = document.getElementById('detectBtn');

    let model;
    let currentImage;

    // –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏
    async function loadModel() {
      status.textContent = '–ó–∞–≥—Ä—É–∂–∞–µ–º –ò–ò –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–æ—Ç–æ–≤... üß†';
      try {
        model = await cocoSsd.load();
        status.textContent = '–ú–æ–¥–µ–ª—å –≥–æ—Ç–æ–≤–∞! –ó–∞–≥—Ä—É–∑–∏ —Ñ–æ—Ç–æ.';
      } catch (err) {
        status.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ò–ò: ' + err.message;
      }
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
    uploadArea.onclick = () => fileInput.click();
    fileInput.onchange = (e) => {
      const file = e.target.files[0];
      if (!file) return;
      loadImage(file);
    };

    // Drag & Drop
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      uploadArea.addEventListener(eventName, preventDefaults, false);
    });
    ['dragenter', 'dragover'].forEach(eventName => {
      uploadArea.addEventListener(eventName, () => uploadArea.classList.add('dragover'), false);
    });
    ['dragleave', 'drop'].forEach(eventName => {
      uploadArea.addEventListener(eventName, () => uploadArea.classList.remove('dragover'), false);
    });
    uploadArea.addEventListener('drop', (e) => {
      const dt = e.dataTransfer;
      const files = dt.files;
      if (files.length) loadImage(files[0]);
    });

    function preventDefaults(e) { e.preventDefault(); e.stopPropagation(); }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    function loadImage(file) {
      if (!file.type.startsWith('image/')) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ!');
        return;
      }

      const reader = new FileReader();
      reader.onload = (e) => {
        currentImage = new Image();
        currentImage.onload = () => {
          imagePreview.src = currentImage.src;
          imagePreview.style.display = 'block';
          canvas.width = currentImage.width;
          canvas.height = currentImage.height;
          canvas.style.display = 'block';
          detectBtn.disabled = false;
          status.textContent = '–§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ! –ù–∞–∂–º–∏ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –∫–æ—Ç–∞"';
        };
        currentImage.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    // –î–µ—Ç–µ–∫—Ü–∏—è –∫–æ—Ç–∞
    async function detectCat() {
      if (!model || !currentImage) return;

      detectBtn.disabled = true;
      detectBtn.textContent = '–ò—â–µ–º –∫–æ—Ç–∞...';
      status.textContent = '–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ñ–æ—Ç–æ... üê±';

      ctx.drawImage(currentImage, 0, 0);
      const predictions = await model.detect(canvas);

      let catFound = false;
      predictions.forEach(pred => {
        if (pred.class === 'cat' && pred.score > 0.5) {
          catFound = true;
          drawBox(pred.bbox, pred.score);
        }
      });

      if (catFound) {
        status.innerHTML = `üòª –ö–û–¢ –û–ë–ù–ê–†–£–ñ–ï–ù! –ú–Ø–£! üêà<br>–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: –≤—ã—Å–æ–∫–∞—è`;
        status.classList.add('cat-detected');
        playMeow();
      } else {
        status.innerHTML = `üòø –ö–æ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ...<br>–ü–æ–ø—Ä–æ–±—É–π –¥—Ä—É–≥–æ–µ —Ñ–æ—Ç–æ!`;
        status.classList.remove('cat-detected');
      }

      detectBtn.disabled = false;
      detectBtn.textContent = 'üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–Ω–æ–≤–∞';
    }

    // –†–∏—Å—É–µ–º —Ä–∞–º–∫—É
    function drawBox(bbox, score) {
      const [x, y, width, height] = bbox;
      ctx.strokeStyle = '#FF69B4';
      ctx.lineWidth = Math.max(3, width * 0.01);
      ctx.strokeRect(x, y, width, height);

      ctx.fillStyle = '#FF69B4';
      ctx.font = `${Math.max(16, width * 0.05)}px Arial`;
      ctx.fillText(`–ö–æ—Ç: ${(score * 100).toFixed(1)}%`, x + 10, y + 30);
    }

    // –ú—è—É–∫–∞–Ω—å–µ
    function playMeow() {
      const meow = new Audio('https://www.soundjay.com/human/sounds/meow-1.wav');
      meow.volume = 0.6;
      meow.play().catch(() => {});
    }

    // –°–±—Ä–æ—Å
    function reset() {
      fileInput.value = '';
      imagePreview.style.display = 'none';
      canvas.style.display = 'none';
      status.textContent = '–í—ã–±–µ—Ä–∏ –Ω–æ–≤–æ–µ —Ñ–æ—Ç–æ...';
      status.classList.remove('cat-detected');
      detectBtn.disabled = true;
      detectBtn.textContent = 'üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –∫–æ—Ç–∞';
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    // –°—Ç–∞—Ä—Ç
    window.onload = () => {
      loadModel();
    };
  </script>
</body>
</html>
